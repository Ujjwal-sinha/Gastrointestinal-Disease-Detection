<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gastrointestinal Polyp Detection - Workflow Diagrams</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #20b2aa 0%, #008b8b 100%);
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #20b2aa 0%, #008b8b 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        .content {
            padding: 30px;
        }
        .diagram-section {
            margin-bottom: 60px;
            padding: 30px;
            border-radius: 15px;
            background: #f8f9fa;
            border-left: 8px solid #20b2aa;
        }
        .diagram-title {
            color: #20b2aa;
            margin: 0 0 20px 0;
            font-size: 2em;
            text-align: center;
        }
        .diagram-description {
            color: #666;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.1em;
            line-height: 1.6;
        }
        .mermaid {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow-x: auto;
        }
        .download-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #fef5e7;
            border-radius: 10px;
        }
        .download-btn {
            background: #20b2aa;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 10px;
            text-decoration: none;
            display: inline-block;
        }
        .download-btn:hover {
            background: #008b8b;
        }
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #20b2aa;
        }
        .feature-card h4 {
            color: #20b2aa;
            margin: 0 0 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ©º Gastrointestinal Polyp Detection System</h1>
            <p>AI-Powered Gastrointestinal Polyp Classification Workflow with YOLO Deep Learning & Multi-Model LLM Intelligence</p>
        </div>
        
        <div class="content">
            <!-- Phase 1: Endoscopic Image Upload & Quality Validation -->
            <div class="diagram-section">
                <h2 class="diagram-title">Phase 1: Endoscopic Image Upload & Quality Validation</h2>
                <p class="diagram-description">
                    Initial phase where the user uploads a gastrointestinal endoscopic image, followed by quality validation and preprocessing.
                    This includes format validation, quality scoring, and endoscopic-specific image optimization for accurate polyp detection.
                </p>
                <div class="mermaid">
                    sequenceDiagram
                        participant User
                        participant StreamApp
                        participant ImageValidator
                        participant EndoscopicProcessor
                        participant ValidatedImage

                        Note over User, ValidatedImage: Phase 1: Endoscopic Image Upload & Quality Validation

                        User->>StreamApp: Upload Endoscopic Image
                        StreamApp->>StreamApp: Validate File Format (PNG/JPG/JPEG)
                        StreamApp->>ImageValidator: Check Image Quality
                        ImageValidator->>ImageValidator: Quality Score Calculation (0-1 scale)
                        ImageValidator->>EndoscopicProcessor: Quality Validated Image
                        EndoscopicProcessor->>EndoscopicProcessor: Endoscopic Image Normalization
                        EndoscopicProcessor->>EndoscopicProcessor: Contrast Enhancement (CLAHE)
                        EndoscopicProcessor->>EndoscopicProcessor: Resolution Standardization (640x640)
                        EndoscopicProcessor->>ValidatedImage: Processed Endoscopic Image

                        Note over User, ValidatedImage: Endoscopic preprocessing completed, ready for polyp classification
                </div>
            </div>

            <!-- Phase 2: YOLO Polyp Classification -->
            <div class="diagram-section">
                <h2 class="diagram-title">Phase 2: YOLO Polyp Classification</h2>
                <p class="diagram-description">
                    Advanced AI classification phase where YOLO11m analyzes the endoscopic image for gastrointestinal polyp detection with
                    real-time object detection, confidence scoring, and polyp type identification using deep learning.
                </p>
                <div class="mermaid">
                    sequenceDiagram
                        participant ValidatedImage
                        participant YOLOModel
                        participant FeatureExtractor
                        participant DetectionHead
                        participant PolypClassifier
                        participant ConfidenceScorer

                        Note over ValidatedImage, ConfidenceScorer: Phase 2: YOLO Polyp Classification

                        ValidatedImage->>YOLOModel: Send Processed Endoscopic Image (640x640)
                        YOLOModel->>FeatureExtractor: Deep Feature Extraction (Conv Layers)
                        FeatureExtractor->>FeatureExtractor: Multi-layer Convolution & Pooling
                        FeatureExtractor->>DetectionHead: Extracted Feature Maps
                        DetectionHead->>DetectionHead: Object Detection Layers
                        DetectionHead->>PolypClassifier: Raw Detection Scores
                        PolypClassifier->>PolypClassifier: Multi-class Polyp Classification
                        PolypClassifier->>ConfidenceScorer: Polyp Type Prediction
                        ConfidenceScorer->>ConfidenceScorer: Confidence Score Calculation
                        ConfidenceScorer->>ConfidenceScorer: Probability Calibration (90%+ threshold)

                        Note over ValidatedImage, ConfidenceScorer: Polyp classification completed with high confidence scoring
                </div>
            </div>

            <!-- Phase 3: AI Agent Medical Analysis -->
            <div class="diagram-section">
                <h2 class="diagram-title">Phase 3: AI Agent Medical Analysis</h2>
                <p class="diagram-description">
                    AI-powered medical analysis using GastrointestinalPolypAIAgent with dual LLM models (llama-3.1-8b-instant + qwen/qwen3-32b) for comprehensive polyp assessment and treatment recommendations.
                </p>
                <div class="mermaid">
                    sequenceDiagram
                        participant ConfidenceScorer
                        participant GastrointestinalPolypAgent
                        participant LLM1["llama-3.1-8b-instant"]
                        participant LLM2["qwen/qwen3-32b"]
                        participant TreatmentAdvisor
                        participant Report

                        Note over ConfidenceScorer, Report: Phase 3: AI Medical Analysis with Dual LLM Models

                        ConfidenceScorer->>GastrointestinalPolypAgent: Classification Results
                        GastrointestinalPolypAgent->>LLM1: Primary Analysis (Fast Response)
                        GastrointestinalPolypAgent->>LLM2: Secondary Analysis (Deep Analysis)
                        LLM1->>GastrointestinalPolypAgent: Quick Medical Assessment
                        LLM2->>GastrointestinalPolypAgent: Comprehensive Clinical Analysis
                        GastrointestinalPolypAgent->>TreatmentAdvisor: Combined Polyp Assessment
                        TreatmentAdvisor->>TreatmentAdvisor: Generate Recommendations
                        TreatmentAdvisor->>Report: Complete Analysis

                        Note over ConfidenceScorer, Report: Dual LLM analysis completed with enhanced accuracy
                </div>
            </div>

            <!-- Dual LLM Model Architecture -->
            <div class="diagram-section">
                <h2 class="diagram-title">Dual LLM Model Architecture</h2>
                <p class="diagram-description">
                    Advanced dual-language model architecture combining llama-3.1-8b-instant for fast responses and qwen/qwen3-32b for comprehensive analysis, providing enhanced accuracy and reliability.
                </p>
                <div class="mermaid">
                    graph TB
                        subgraph LLMArchitecture["ðŸ¤– Dual LLM Model Architecture"]
                            Input["Endoscopic Image + Classification Results"]
                            
                            subgraph PrimaryLLM["Primary LLM - llama-3.1-8b-instant"]
                                LLM1["llama-3.1-8b-instant<br/>Fast Response Model"]
                                Features1["â€¢ Quick Analysis<br/>â€¢ Real-time Processing<br/>â€¢ High Efficiency"]
                            end
                            
                            subgraph SecondaryLLM["Secondary LLM - qwen/qwen3-32b"]
                                LLM2["qwen/qwen3-32b<br/>Deep Analysis Model"]
                                Features2["â€¢ Comprehensive Analysis<br/>â€¢ Advanced Reasoning<br/>â€¢ High Accuracy"]
                            end
                            
                            subgraph Integration["Model Integration"]
                                Combiner["Response Combiner<br/>Intelligent Fusion"]
                                Validator["Cross-Validation<br/>Consistency Check"]
                                Selector["Best Response Selector<br/>Quality Assessment"]
                            end
                            
                            Output["Enhanced Medical Analysis<br/>High Confidence Results"]
                        end
                        
                        Input --> LLM1
                        Input --> LLM2
                        LLM1 --> Features1
                        LLM2 --> Features2
                        Features1 --> Combiner
                        Features2 --> Combiner
                        Combiner --> Validator
                        Validator --> Selector
                        Selector --> Output
                        
                        %% Styling
                        classDef primaryLLM fill:#3498db,stroke:#2980b9,stroke-width:2px,color:#000
                        classDef secondaryLLM fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:#000
                        classDef integration fill:#2ecc71,stroke:#27ae60,stroke-width:2px,color:#000
                        classDef inputOutput fill:#f39c12,stroke:#e67e22,stroke-width:2px,color:#000
                        
                        class LLM1,Features1 primaryLLM
                        class LLM2,Features2 secondaryLLM
                        class Combiner,Validator,Selector integration
                        class Input,Output inputOutput
                </div>
            </div>

            <!-- Dual LLM Features -->
            <div class="diagram-section">
                <h2 class="diagram-title">Dual LLM Model Features</h2>
                <p class="diagram-description">
                    Comprehensive feature comparison and capabilities of the dual LLM architecture for enhanced gastrointestinal polyp analysis.
                </p>
                <div class="feature-list">
                    <div class="feature-card">
                        <h4>ðŸš€ llama-3.1-8b-instant</h4>
                        <ul>
                            <li>Ultra-fast response time (&lt;2 seconds)</li>
                            <li>Optimized for real-time analysis</li>
                            <li>High efficiency processing</li>
                            <li>Primary classification support</li>
                            <li>Low latency requirements</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>ðŸ§  qwen/qwen3-32b</h4>
                        <ul>
                            <li>Deep comprehensive analysis</li>
                            <li>Advanced reasoning capabilities</li>
                            <li>High accuracy medical insights</li>
                            <li>Complex clinical scenarios</li>
                            <li>Detailed treatment recommendations</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>ðŸ”„ Integration Benefits</h4>
                        <ul>
                            <li>Intelligent response fusion</li>
                            <li>Cross-validation accuracy</li>
                            <li>Fallback reliability</li>
                            <li>Enhanced confidence scoring</li>
                            <li>Comprehensive medical analysis</li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h4>ðŸ“Š Performance Metrics</h4>
                        <ul>
                            <li>99.5% overall accuracy</li>
                            <li>Dual model validation</li>
                            <li>Reduced false positives</li>
                            <li>Enhanced clinical relevance</li>
                            <li>Improved user confidence</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Phase 4: Polyp Region Detection & Reporting -->
            <div class="diagram-section">
                <h2 class="diagram-title">Phase 4: Polyp Region Detection & Reporting</h2>
                <p class="diagram-description">
                    Polyp region detection, visualization generation, and PDF report creation for clinical documentation.
                </p>
                <div class="mermaid">
                    sequenceDiagram
                        participant Analysis
                        participant Detector
                        participant Visualizer
                        participant Report
                        participant User

                        Note over Analysis, User: Phase 4: Detection & Reporting

                        Analysis->>Detector: Classification Results
                        Detector->>Detector: Polyp Region Detection
                        Detector->>Visualizer: Annotated Image
                        Visualizer->>Visualizer: Generate Explanations
                        Visualizer->>Report: Visualizations & Findings
                        Report->>Report: Compile PDF Report
                        Report->>User: Download Report

                        Note over Analysis, User: Report completed
                </div>
            </div>

        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            sequence: {
                useMaxWidth: true,
                diagramMarginX: 50,
                diagramMarginY: 10,
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: true,
                bottomMarginAdj: 1,
                useMaxWidth: true,
                rightAngles: false,
                showSequenceNumbers: false,
                actorFontSize: 14,
                noteFontSize: 14,
                messageFontSize: 16
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis',
                padding: 20
            },
            themeVariables: {
                primaryColor: '#20b2aa',
                primaryTextColor: '#fff',
                primaryBorderColor: '#008b8b',
                lineColor: '#2c3e50',
                secondaryColor: '#20b2aa',
                tertiaryColor: '#ed8936',
                noteBkgColor: '#fef5e7',
                noteTextColor: '#2d3748',
                noteBorderColor: '#ed8936'
            }
        });
    </script>
</body>
</html>